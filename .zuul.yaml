---
- project:
    templates:
      - publish-stx-docs
      - stx-api-ref-jobs
      - stx-release-notes-jobs
    check:
      jobs:
        - openstack-tox-linters
        - sysinv-tox-py27
        - sysinv-tox-py35
        - sysinv-tox-flake8
        - sysinv-tox-pylint
        - sysinv-tox-bandit
        - controllerconfig-tox-flake8
        - controllerconfig-tox-py27
        - controllerconfig-tox-pylint
        - cgtsclient-tox-py27
        - cgtsclient-tox-pep8
        - cgtsclient-tox-pylint
    gate:
      jobs:
        - openstack-tox-linters
        - sysinv-tox-py27
        - sysinv-tox-py35
        - sysinv-tox-flake8
        - sysinv-tox-pylint
        - sysinv-tox-bandit
        - controllerconfig-tox-flake8
        - controllerconfig-tox-py27
        - controllerconfig-tox-pylint
        - cgtsclient-tox-py27
        - cgtsclient-tox-pep8
        - cgtsclient-tox-pylint

- job:
    name: sysinv-tox-py27
    parent: tox
    description: |
      Run py27 test for sysinv
    nodeset: ubuntu-xenial
    required-projects:
      - starlingx/fault
      - starlingx/update
      - starlingx/utilities
    files:
      - sysinv/sysinv/*
    vars:
      tox_envlist: py27
      tox_extra_args: -c sysinv/sysinv/sysinv/tox.ini

- job:
    name: sysinv-tox-py35
    parent: tox
    description: |
      Run py35 test for sysinv
    nodeset: ubuntu-xenial
    required-projects:
      - starlingx/fault
      - starlingx/update
      - starlingx/utilities
    files:
      - sysinv/sysinv/*
    vars:
      tox_envlist: py35
      tox_extra_args: -c sysinv/sysinv/sysinv/tox.ini

- job:
    name: sysinv-tox-flake8
    parent: tox
    description: |
      Run flake8 test for sysinv
    files:
      - sysinv/sysinv/*
    vars:
      tox_envlist: flake8
      tox_extra_args: -c sysinv/sysinv/sysinv/tox.ini

- job:
    name: sysinv-tox-pylint
    parent: tox
    description: |
      Run pylint test for sysinv
    required-projects:
      - starlingx/fault
      - starlingx/update
      - starlingx/utilities
    files:
      - sysinv/sysinv/*
    vars:
      tox_envlist: pylint
      tox_extra_args: -c sysinv/sysinv/sysinv/tox.ini

- job:
    name: sysinv-tox-bandit
    parent: tox
    description: |
      Run bandit test for sysinv
    files:
      - sysinv/sysinv/*
    vars:
      tox_envlist: bandit
      tox_extra_args: -c sysinv/sysinv/sysinv/tox.ini

- job:
    name: controllerconfig-tox-flake8
    parent: tox
    description: Run flake8 tests for controllerconfig
    files:
      - controllerconfig/*
    vars:
      tox_envlist: flake8
      tox_extra_args: -c controllerconfig/controllerconfig/tox.ini

- job:
    name: controllerconfig-tox-py27
    parent: tox
    description: Run py27 tests for controllerconfig
    required-projects:
      - starlingx/fault
    files:
      - controllerconfig/*
    vars:
      tox_envlist: py27
      tox_extra_args: -c controllerconfig/controllerconfig/tox.ini

- job:
    name: controllerconfig-tox-pylint
    parent: tox
    description: Run pylint tests for controllerconfig
    required-projects:
      - starlingx/fault
    files:
      - controllerconfig/*
    vars:
      tox_envlist: pylint
      tox_extra_args: -c controllerconfig/controllerconfig/tox.ini

- job:
    name: flock-devstack-config
    parent: flock-devstack-base
    required-projects:
      - starlingx/fault
      - starlingx/update
      - starlingx/utilities
    vars:
      tox_envlist: functional
      devstack_services:
        # StarlingX services
        fm-common: true
        fm-api: true
        cgtsclient: true
        sysinv-agent: true
        sysinv-api: true
        sysinv-cond: true
        tls-proxy: false
      devstack_plugins:
        config: https://opendev.org/starlingx/config
        fault: https://opendev.org/starlingx/fault
        integ: https://opendev.org/starlingx/integ
        update: https://opendev.org/starlingx/update

- job:
    name: cgtsclient-tox-py27
    parent: tox
    description: |
      Run py27 test for cgts-client
    files:
      - sysinv/cgts-client/*
    vars:
      tox_envlist: py27
      tox_extra_args: -c sysinv/cgts-client/cgts-client/tox.ini

- job:
    name: cgtsclient-tox-pep8
    parent: tox
    description: |
      Run pep8 test for cgts-client
    files:
      - sysinv/cgts-client/*
    vars:
      tox_envlist: pep8
      tox_extra_args: -c sysinv/cgts-client/cgts-client/tox.ini

- job:
    name: cgtsclient-tox-pylint
    parent: tox
    description: |
      Run pylint test for cgts-client
    files:
      - sysinv/cgts-client/*
    vars:
      tox_envlist: pylint
      tox_extra_args: -c sysinv/cgts-client/cgts-client/tox.ini
